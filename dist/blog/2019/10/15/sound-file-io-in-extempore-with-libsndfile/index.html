<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><title>Sound file I/O in Extempore with libsndfile | benswift.me</title><meta name="author" content="Ben Swift"><meta name="description" content="libsndfile is &#34;a C library for reading and writing files containing sampled audio data&#34;, and it's pretty great. Here's a quick crash-course on using‚Ä¶"><!-- Open Graph --><meta property="og:url" content="https://benswift.me/blog/2019/10/15/sound-file-io-in-extempore-with-libsndfile/"><meta property="og:type" content="article"><meta property="og:site_name" content="benswift.me"><meta property="og:title" content="Sound file I/O in Extempore with libsndfile"><meta property="og:description" content="libsndfile is &#34;a C library for reading and writing files containing sampled audio data&#34;, and it's pretty great. Here's a quick crash-course on using‚Ä¶"><meta property="og:image" content="https://benswift.me/assets/images/pages/theremin-75.webp"><!-- Twitter --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@benswift"><meta name="twitter:title" content="Sound file I/O in Extempore with libsndfile"><meta name="twitter:description" content="libsndfile is &#34;a C library for reading and writing files containing sampled audio data&#34;, and it's pretty great. Here's a quick crash-course on using‚Ä¶"><meta name="twitter:image" content="https://benswift.me/assets/images/pages/theremin-75.webp"><!-- AT Protocol --><link rel="site.standard.document" href="at://did:plc:tevykrhi4kibtsipzci76d76/site.standard.document/2019-10-15-sound-file-io-in-extempore-with-libsndfile"><!-- Citation metadata --><meta name="citation_title" content="Sound file I/O in Extempore with libsndfile"><meta name="citation_author" content="Ben Swift"><meta name="citation_date" content="2019-10-15"><meta name="citation_public_url" content="https://benswift.me/blog/2019/10/15/sound-file-io-in-extempore-with-libsndfile/"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CDGfc0hd.js"></script><script>
      // Runs before paint to avoid flash of wrong theme
      ;(function() {
        const theme = localStorage.getItem("theme")
        if (theme === "dark" || (!theme && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
          document.documentElement.classList.add("dark")
        }
      })()
    </script><link rel="stylesheet" href="/_astro/_slug_.BYY5YBAZ.css">
<style>.tag-container[data-astro-cid-lga65v7i]{display:flex;flex-wrap:wrap;gap:.5rem;margin:.5rem 0}.tag[data-astro-cid-lga65v7i]{display:inline-block;padding:.25rem .5rem;background-color:var(--bg-soft);border-radius:4px;font-size:.875rem;color:var(--text-2);text-decoration:none;transition:background-color .2s,color .2s}.tag[data-astro-cid-lga65v7i]:hover{background-color:var(--brand-soft);color:var(--brand-1)}
.cite-post[data-astro-cid-srla3z7m]{margin-top:2rem;border:1px solid var(--divider);border-radius:8px;padding:.75rem 1rem}.cite-post[data-astro-cid-srla3z7m] summary[data-astro-cid-srla3z7m]{cursor:pointer;font-size:.875rem;color:var(--text-2);user-select:none}.cite-content[data-astro-cid-srla3z7m]{margin-top:.75rem}.cite-content[data-astro-cid-srla3z7m] pre[data-astro-cid-srla3z7m]{background:var(--bg-soft);border-radius:6px;padding:1rem;overflow-x:auto;font-size:.8rem;line-height:1.5}.cite-copy[data-astro-cid-srla3z7m]{margin-top:.5rem;padding:.35rem .75rem;font-size:.8rem;border:1px solid var(--divider);border-radius:4px;background:var(--bg-soft);color:var(--text-2);cursor:pointer;transition:all .2s ease}.cite-copy[data-astro-cid-srla3z7m]:hover{color:var(--brand-1);border-color:var(--brand-1)}
.neon-perceptron.svelte-1ox9ddm{position:relative;width:100%;aspect-ratio:16 / 9;background:#111;border-radius:8px;overflow:hidden}.neon-perceptron.fullscreen.svelte-1ox9ddm{aspect-ratio:unset;width:100vw;height:100vh;border-radius:0}.neon-perceptron.svelte-1ox9ddm canvas{display:block}.controls.svelte-1ox9ddm{position:absolute;top:1rem;left:1rem;display:flex;flex-direction:column;gap:.5rem;z-index:100}.controls.svelte-1ox9ddm button:where(.svelte-1ox9ddm){padding:.5rem 1rem;background:#333;color:#fff;border:1px solid #666;border-radius:4px;cursor:pointer;font-size:.875rem;transition:background .2s}.controls.svelte-1ox9ddm button:where(.svelte-1ox9ddm):hover{background:#444}.slider-container.svelte-1ox9ddm{background:#333;padding:.5rem;border:1px solid #666;border-radius:4px;color:#fff;font-size:.75rem}.slider-container.svelte-1ox9ddm label:where(.svelte-1ox9ddm){display:flex;flex-direction:column;gap:.25rem}.slider-container.svelte-1ox9ddm input[type=range]:where(.svelte-1ox9ddm){width:120px}.fullscreen-button.svelte-1ox9ddm{position:absolute;top:1rem;right:1rem;width:2.5rem;height:2.5rem;padding:.5rem;background:#333;color:#fff;border:1px solid #666;border-radius:4px;cursor:pointer;z-index:100;transition:background .2s}.fullscreen-button.svelte-1ox9ddm:hover{background:#444}.fullscreen-button.svelte-1ox9ddm svg:where(.svelte-1ox9ddm){width:100%;height:100%}
.for-codes-table.svelte-gplc73 .search:where(.svelte-gplc73){width:100%;line-height:1.6;font-size:1rem;padding:.3rem .6rem;border:2px solid var(--brand-1);border-radius:3px;margin-bottom:1rem}.for-codes-table.svelte-gplc73 table:where(.svelte-gplc73){width:100%;border-collapse:collapse}.for-codes-table.svelte-gplc73 th:where(.svelte-gplc73),.for-codes-table.svelte-gplc73 td:where(.svelte-gplc73){padding:.5rem;text-align:left;border-bottom:1px solid var(--divider)}.for-codes-table.svelte-gplc73 .for-code:where(.svelte-gplc73){font-family:var(--font-family-mono);white-space:nowrap}
</style></head> <body> <header class="site-header" data-pagefind-ignore data-astro-cid-dmqpwcec> <nav class="nav-container" aria-label="Main navigation" data-astro-cid-dmqpwcec> <a href="/" class="site-title" data-astro-cid-dmqpwcec>benswift.me</a> <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="nav-links" data-astro-cid-dmqpwcec> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-dmqpwcec> <line x1="3" y1="6" x2="21" y2="6" data-astro-cid-dmqpwcec></line> <line x1="3" y1="12" x2="21" y2="12" data-astro-cid-dmqpwcec></line> <line x1="3" y1="18" x2="21" y2="18" data-astro-cid-dmqpwcec></line> </svg> </button> <div id="nav-links" class="nav-links" data-astro-cid-dmqpwcec> <a href="/blog/" class="nav-link" data-astro-cid-dmqpwcec>Blog</a><a href="/research/" class="nav-link" data-astro-cid-dmqpwcec>Research</a><a href="/livecoding/" class="nav-link" data-astro-cid-dmqpwcec>Livecoding</a><a href="/teaching/" class="nav-link" data-astro-cid-dmqpwcec>Teaching</a><a href="/bio/" class="nav-link" data-astro-cid-dmqpwcec>Bio</a> <div class="nav-social" data-astro-cid-dmqpwcec> <a href="https://github.com/benswift" class="social-link" aria-label="GitHub" target="_blank" rel="noopener" data-astro-cid-dmqpwcec> <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-dmqpwcec> <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z" data-astro-cid-dmqpwcec></path>   </svg> </a><a href="https://bsky.app/profile/benswift.me" class="social-link" aria-label="Bluesky" target="_blank" rel="noopener" data-astro-cid-dmqpwcec> <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-dmqpwcec>  <path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479.785 2.627 3.608 3.494 6.21 3.16-.084.078-3.597.534-5.01 2.583-1.164 1.685.291 3.412 1.576 4.01 4.233 1.972 6.6-1.95 7.6-4.45.999 2.5 3.367 6.422 7.6 4.45 1.285-.598 2.74-2.325 1.576-4.01-1.413-2.049-4.926-2.505-5.01-2.583 2.602.334 5.425-.533 6.21-3.16.246-.829.624-5.789.624-6.478 0-.69-.139-1.861-.902-2.204-.659-.299-1.664-.62-4.3 1.24C14.046 4.747 11.087 8.686 12 10.8z" data-astro-cid-dmqpwcec></path>  </svg> </a><a href="https://www.linkedin.com/in/benjswift" class="social-link" aria-label="LinkedIn" target="_blank" rel="noopener" data-astro-cid-dmqpwcec> <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-dmqpwcec>   <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" data-astro-cid-dmqpwcec></path> </svg> </a> </div> <div class="search-container" data-astro-cid-otpdt6jm> <button class="search-toggle" aria-label="Search" title="Search (Ctrl+K)" data-astro-cid-otpdt6jm> <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-otpdt6jm> <circle cx="11" cy="11" r="8" data-astro-cid-otpdt6jm></circle> <line x1="21" y1="21" x2="16.65" y2="16.65" data-astro-cid-otpdt6jm></line> </svg> </button> <dialog class="search-dialog" data-astro-cid-otpdt6jm> <div id="pagefind-search" data-astro-cid-otpdt6jm></div> <button class="search-close" aria-label="Close search" data-astro-cid-otpdt6jm> <kbd data-astro-cid-otpdt6jm>Esc</kbd> </button> </dialog> </div>   <script>
  (function() {
    let pagefindLoaded = false

    async function loadPagefind() {
      if (pagefindLoaded) return
      pagefindLoaded = true
      try {
        const link = document.createElement("link")
        link.rel = "stylesheet"
        link.href = "/pagefind/pagefind-ui.css"
        document.head.appendChild(link)

        const script = document.createElement("script")
        script.src = "/pagefind/pagefind-ui.js"
        await new Promise((resolve, reject) => {
          script.onload = resolve
          script.onerror = reject
          document.head.appendChild(script)
        })

        new window.PagefindUI({
          element: "#pagefind-search",
          showSubResults: true,
          showImages: false,
        })
      } catch {
        const el = document.getElementById("pagefind-search")
        if (el) el.innerHTML = "<p>Search is not available in dev mode.</p>"
      }
    }

    function initSearch() {
      const toggle = document.querySelector(".search-toggle")
      const dialog = document.querySelector(".search-dialog")
      const close = document.querySelector(".search-close")

      if (toggle) {
        toggle.addEventListener("click", async function() {
          if (!dialog) return
          await loadPagefind()
          dialog.showModal()
          var input = dialog.querySelector(".pagefind-ui__search-input")
          if (input) input.focus()
        })
      }

      if (close) {
        close.addEventListener("click", function() {
          if (dialog) dialog.close()
        })
      }
    }

    function handleKeydown(e) {
      if ((e.ctrlKey || e.metaKey) && e.key === "k") {
        e.preventDefault()
        var dialog = document.querySelector(".search-dialog")
        if (!dialog) return
        loadPagefind().then(function() {
          if (dialog.open) {
            dialog.close()
          } else {
            dialog.showModal()
            var input = dialog.querySelector(".pagefind-ui__search-input")
            if (input) input.focus()
          }
        })
      }
    }

    document.removeEventListener("keydown", handleKeydown)
    document.addEventListener("keydown", handleKeydown)

    initSearch()
    document.addEventListener("astro:page-load", initSearch)
  })()
</script> <button class="dark-mode-toggle" aria-label="Toggle dark mode" title="Toggle dark mode" data-astro-cid-dmqpwcec> <svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-dmqpwcec> <circle cx="12" cy="12" r="5" data-astro-cid-dmqpwcec></circle> <line x1="12" y1="1" x2="12" y2="3" data-astro-cid-dmqpwcec></line> <line x1="12" y1="21" x2="12" y2="23" data-astro-cid-dmqpwcec></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" data-astro-cid-dmqpwcec></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" data-astro-cid-dmqpwcec></line> <line x1="1" y1="12" x2="3" y2="12" data-astro-cid-dmqpwcec></line> <line x1="21" y1="12" x2="23" y2="12" data-astro-cid-dmqpwcec></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" data-astro-cid-dmqpwcec></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" data-astro-cid-dmqpwcec></line> </svg> <svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-dmqpwcec> <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" data-astro-cid-dmqpwcec></path> </svg> </button> </div> </nav> </header>  <script type="module">function n(){const e=document.querySelector(".mobile-menu-toggle"),o=document.querySelector("#nav-links");e?.addEventListener("click",()=>{const t=e.getAttribute("aria-expanded")==="true";e.setAttribute("aria-expanded",String(!t)),o?.classList.toggle("open")}),document.querySelector(".dark-mode-toggle")?.addEventListener("click",()=>{const t=document.documentElement.classList.toggle("dark");localStorage.setItem("theme",t?"dark":"light")})}n();document.addEventListener("astro:page-load",n);</script> <main data-pagefind-body>  <h1 class="page-title">Sound file I/O in Extempore with libsndfile</h1> <p class="post-date">15 Oct 19</p> <p class="tag-container" data-astro-cid-lga65v7i><a href="/blog/tag/extempore/" class="tag" data-astro-cid-lga65v7i>extempore</a></p>  <p><a href="https://github.com/erikd/libsndfile/">libsndfile</a> is ‚Äúa C library for reading
and writing files containing sampled audio data‚Äù, and it‚Äôs pretty great. Here‚Äôs
a quick crash-course on using
<a href="https://github.com/digego/extempore/blob/master/libs/external/sndfile.xtm">Extempore‚Äôs libsndfile bindings</a>
to read, process and write audio data files.</p>
<h2 id="loading-the-xtlang-wrappers-for-the-sndfile-library-functions">Loading the xtlang wrappers for the sndfile library functions</h2>
<p>Once you‚Äôve got Extempore up and running, the first thing to do is to load the
libsndfile wrapper functions:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xtlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">sys:load</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "libs/external/sndfile.xtm"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span></code></pre>
<p><code>libs/external/sndlib.xtm</code> contains <code>bind-lib</code> definitions for all<sup><a href="#user-content-fn-pm-all" id="user-content-fnref-pm-all" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup> the
functions in the libsndfile library (compare that file to the
<a href="https://github.com/erikd/libsndfile/blob/master/src/sndfile.h.in">C header</a> to
see for yourself).</p>
<p>In this blog post I‚Äôm mostly going to write ‚Äúthin‚Äù xtlang code---calling the C
functions directly wherever possible, and using the same basic types as the
underlying C library. You could easily write xtlang helper functions to make all
this stuff nicer, and <code>libs/external/sndfile.xtm</code> actually has a bunch of these
as well (down the bottom of that file). However, I hope this bare-bones approach
is helpful for understanding what‚Äôs going on (and how you might use other C
shared libs if you wanted to).</p>
<h2 id="reading-the-audio-file-data-into-memory">Reading the audio file data into memory</h2>
<p>In a fairly common API design pattern, to get info about a sound file (length,
channels, sample rate, format, etc.) we need to:</p>
<ol>
<li>
<p>use <code>sf_open</code> to give us a pointer to the data structure which libsndfile
uses to represent the audio file (a <code>SNDFILE*</code>)</p>
</li>
<li>
<p>pass a pointer to another data structure (a <code>SF_INFO*</code>) which <code>sf_open</code> will
populate with info about the file</p>
</li>
</ol>
<p><code>sf_open</code> doesn‚Äôt read the audio data into memory (where we can do stuff with
it) though---because first we need to figure out how big a buffer to allocate
for the data---and to do that, we need to know how many frames there are in the
audio file, and how many channels per frame.</p>
<p>Looking at the documentation (i.e. the comment above the function declaration in
the C header file) for <code>SF_INFO</code> we see that the first (tuple index <code>0</code>) and
third (tuple index <code>2</code>) fields are going to be useful</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">struct</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> SF_INFO</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{   </span><span style="color:#005CC5;--shiki-dark:#79B8FF">sf_count_t</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  frames ;</span><span style="color:#6A737D;--shiki-dark:#6A737D">        /* Used to be called samples.  Changed to avoid confusion. */</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">         samplerate ;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">         channels ;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">         format ;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">         sections ;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">         seekable ;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">} ;</span></span></code></pre>
<p>Using all this info, then, we can make a simple xtlang function to return the
number of frames</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xtlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">bind-func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> get_number_of_frames</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#D73A49;--shiki-dark:#F97583">lambda</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (filename)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((info</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:SF_INFO*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (salloc))</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">          ;; call sf_info to populate info with data about the file</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          (sfile (sf_open filename SFM_READ info)))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      (sf_close sfile)</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">      ;; return the number of frames</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      (</span><span style="color:#D73A49;--shiki-dark:#F97583">tref</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> info </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">;; test it out using a wave file from the Extempore assets directory</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">;; (it should return the number 288366)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(get_number_of_frames </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"assets/samples/piano/60.wav"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span></code></pre>
<p>::: tip</p>
<p>Most of the code in this post doesn‚Äôt check for e.g. bad filenames or other
potential errors, so if that‚Äôs a thing which might happen in your situation then
you‚Äôll need to check that <code>sf_open</code> doesn‚Äôt return <code>null</code>.</p>
<p>:::</p>
<p>We can do the exact same thing to get the number of channels per frame (just
returning a different element of the <code>info</code> struct):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xtlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">bind-func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> get_number_of_channels</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#D73A49;--shiki-dark:#F97583">lambda</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (filename)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((info</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:SF_INFO*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (salloc))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          (sfile (sf_open filename SFM_READ info)))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      (sf_close sfile)</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">      ;; return the number of channels</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      (</span><span style="color:#D73A49;--shiki-dark:#F97583">tref</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> info </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">;; returns 2 (it's a stereo file)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(get_number_of_channels </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"assets/samples/piano/60.wav"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span></code></pre>
<p>Finally, we can calculate how many samples (num frames √ó num channels) we‚Äôll
need in our ‚Äúaudio data‚Äù buffer. We can then use <code>sf_read</code> to read the audio
data from the file into our buffer, converting it to e.g. <code>float</code> (or whatever
the type of <code>SAMPLE</code> is) as we go (libsndfile can read audio files in a bunch of
different formats, but for working with it in Extempore we just want floating
point values).</p>
<p>First, set up a DSP callback---just playing white noise so that we can check
that it‚Äôs working.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xtlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">bind-func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dsp</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:DSP</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#D73A49;--shiki-dark:#F97583">lambda</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (in time chan dat)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">random</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> .</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(dsp</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:set!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dsp)</span></span></code></pre>
<p>Now, we add a bunch of sndfile-related stuff to the top-level <code>dsp</code> closure
environment (the outer <code>let</code>) to</p>
<ol>
<li>get the number of frames/channels from the file</li>
<li>allocate a <code>SAMPLE</code><sup><a href="#user-content-fn-sample" id="user-content-fnref-sample" data-footnote-ref="" aria-describedby="footnote-label">2</a></sup> buffer big enough to fit all the audio data</li>
<li>read the audio file data into this buffer</li>
</ol>
<p>Finally, in the inner <code>lambda</code> we have a super-naive playback loop (look at the
way we‚Äôre incrementing <code>i</code>---this will only work if the number of output
channels matches the number of channels in the audio file).</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xtlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">bind-func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dsp</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:DSP</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10000000</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ;; allocate plenty of memory for our DSP closure</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((filename </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"assets/samples/piano/60.wav"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (nframes (get_number_of_frames filename))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (nchan (convert (get_number_of_channels filename)))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (nsamp (* nframes nchan))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (info</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:SF_INFO*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (alloc))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (sfile (sf_open filename SFM_READ info)) </span><span style="color:#6A737D;--shiki-dark:#6A737D">;; SFM_READ = open the audio file in "read-only" mode</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        ;; here's the pointer to the audio data</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (data</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:SAMPLE*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (alloc nsamp))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (i </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">println</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "read"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (sf_read sfile data nsamp) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"frames"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (sf_close sfile)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#D73A49;--shiki-dark:#F97583">lambda</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (in time chan dat)</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">      ;; a super-naive "playback" loop</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      (set! i (% (+ i </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) nsamp))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      (* .</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">pref</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> data i)))))</span></span></code></pre>
<p>If it‚Äôs all worked, you should hear a piano playing repeated (legato) notes on
middle C.</p>
<p>Of course, we could have simplified this by just calling <code>sf_open</code> and
populating the <code>info</code> with data once at the top of an xtlang function, then
doing stuff based on that information and finally <code>sf_close</code>ing the file at the
end. That‚Äôs left as an exercise for the reader üòâ</p>
<p>::: tip</p>
<p>One thing worth noting with all this is that calling a C lib from Extempore
doesn‚Äôt obviate the need to understand how the C library works, e.g. we still
need to match every call to <code>sf_open</code> with a call to <code>sf_close</code> as stated in the
libsndfile docs.</p>
<p>:::</p>
<h2 id="writing-data-in-memory-to-an-audio-file">Writing data in memory to an audio file</h2>
<p>There‚Äôs one more thing we want to do with our libsndfile library: write a bunch
of audio data (which we‚Äôve gloriously munged in Extempore) and write it back to
an audio file.</p>
<p>Here‚Äôs a simple munging function which will replace the first <code>22050</code> samples
with white noise, then leave the next <code>22050</code> untouched, then replace the next
<code>22050</code> with more white noise, and so on. I‚Äôm sure you can come up with
something more (sonically) interesting; this is just an easy one to test (by
ear) if it‚Äôs working.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xtlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">bind-func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> munge_audio_data</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#D73A49;--shiki-dark:#F97583">lambda</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (data</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:SAMPLE*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nsamp)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (doloop (i nsamp)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      (</span><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">modulo</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#005CC5;--shiki-dark:#79B8FF">44100</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">22050</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          (pset! data i (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">random</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> .</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))))))</span></span></code></pre>
<p>The final thing to do is to create <em>another</em> <code>SNDFILE</code> object (this time opened
in <code>SFM_WRITE</code> mode) where we‚Äôll write the audio data. We‚Äôll make some small
additions to our <code>dsp</code> closure:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xtlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">bind-func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dsp</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:DSP</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10000000</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ;; allocate plenty of memory for our DSP closure</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((filename </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"assets/samples/piano/60.wav"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (nframes (get_number_of_frames filename))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (nchan (convert (get_number_of_channels filename)))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (nsamp (* nframes nchan))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (info</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:SF_INFO*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (alloc))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (srcfile (sf_open filename SFM_READ info))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (dstfile (sf_open  </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"assets/samples/piano/60-munged.wav"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> SFM_WRITE info))</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        ;; here's the pointer to the audio data</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (data</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:SAMPLE*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (alloc nsamp))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (i </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">println</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "read"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (sf_read srcfile data nsamp) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"frames"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (sf_close srcfile)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ;; munge the audio data</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (munge_audio_data data nsamp)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">println</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "wrote"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (sf_write dstfile data nsamp) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"frames"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (sf_close dstfile)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#D73A49;--shiki-dark:#F97583">lambda</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (in time chan dat)</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">      ;; a super-naive "playback" loop</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      (set! i (% (+ i </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) nsamp))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      (* .</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">pref</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> data i)))))</span></span></code></pre>
<p>If you re-evaluate <em>that</em> <code>dsp</code> closure, you should (a) hear the munged audio
and (b) it should have been written to the ‚Äúassets/samples/piano/60-munged.wav‚Äù
file. Note that we re-used the <code>info</code> data structure (which was populated with
the info from <code>srcfile</code>) in the <code>dstfile</code> call---this is deliberate, and makes
sure that we use the same file format for the output file as for the input file.
If you want to write it in some <em>other</em> format, then look at the libsndfile
docs---there are lots of options.</p>
<h2 id="wrapping-up">Wrapping up</h2>
<p>There‚Äôs lots more to explore, but I‚Äôll leave it here for now. If you‚Äôve got any
comments, then get in touch on the
<a href="mailto:extemporelang@googlegroups.com">Extempore mailing list</a>.</p>
<p>[c-xtlang-interop]: There‚Äôs more detail on how this works in the
<a href="https://extemporelang.github.io/docs/reference/c-xtlang-interop/">Extempore docs</a>
if you‚Äôre interested.</p>
<section data-footnotes="" class="footnotes"><h2 class="sr-only" id="footnote-label">Footnotes</h2>
<ol>
<li id="user-content-fn-pm-all">
<p>well, <em>pretty much</em> all <a href="#user-content-fnref-pm-all" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-sample">
<p><code>SAMPLE</code> is an alias for <code>float</code> by default <a href="#user-content-fnref-sample" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">‚Ü©</a></p>
</li>
</ol>
</section>  <details class="cite-post" data-astro-cid-srla3z7m> <summary data-astro-cid-srla3z7m>Cite this post</summary> <div class="cite-content" data-astro-cid-srla3z7m> <pre data-astro-cid-srla3z7m><code data-astro-cid-srla3z7m>@online{swift2019soundFileIoInExtemporeWithLibsndfile,
  author = {Ben Swift},
  title = {Sound file I/O in Extempore with libsndfile},
  url = {https://benswift.me/blog/2019/10/15/sound-file-io-in-extempore-with-libsndfile/},
  year = {2019},
  month = {10},
  note = {AT-URI: at://did:plc:tevykrhi4kibtsipzci76d76/site.standard.document/2019-10-15-sound-file-io-in-extempore-with-libsndfile},
}</code></pre> <button class="cite-copy" data-bibtex="@online{swift2019soundFileIoInExtemporeWithLibsndfile,
  author = {Ben Swift},
  title = {Sound file I/O in Extempore with libsndfile},
  url = {https://benswift.me/blog/2019/10/15/sound-file-io-in-extempore-with-libsndfile/},
  year = {2019},
  month = {10},
  note = {AT-URI: at://did:plc:tevykrhi4kibtsipzci76d76/site.standard.document/2019-10-15-sound-file-io-in-extempore-with-libsndfile},
}" data-astro-cid-srla3z7m>Copy BibTeX</button> </div> </details>  <script type="module">function i(){document.querySelectorAll(".cite-copy").forEach(t=>{t.addEventListener("click",async()=>{const e=t.dataset.bibtex;e&&(await navigator.clipboard.writeText(e),t.textContent="Copied",setTimeout(()=>t.textContent="Copy BibTeX",2e3))})})}i();document.addEventListener("astro:page-load",i);</script> <footer class="site-footer" data-pagefind-ignore data-astro-cid-gcn2mc3v> <p data-astro-cid-gcn2mc3v>
designed &amp; built with
<a href="https://astro.build" title="Astro website" data-astro-cid-gcn2mc3v>&#9889;</a>,
<a href="#" class="random-cafe" title="See Ben's favourite coffee shops" data-astro-cid-gcn2mc3v>&#9749;</a>
and
<a href="https://www.youtube.com/watch?v=6H2FRxvsd2M" title="What is love?" data-astro-cid-gcn2mc3v>&#10084;</a>
on unceded
<a href="https://www.nca.gov.au/welcome-ngunnawal-country" data-astro-cid-gcn2mc3v>Ngunnawal Country</a>
by Ben Swift
</p> <p class="footer-links" data-astro-cid-gcn2mc3v> <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" class="licence" aria-label="Creative Commons Attribution-ShareAlike 4.0 licence" data-astro-cid-gcn2mc3v>cc by-sa</a>
&middot;
<a href="https://github.com/benswift/benswift.github.io/blob/main/blog/2019/10/15/sound-file-io-in-extempore-with-libsndfile" data-astro-cid-gcn2mc3v>source</a>
&middot;
<a href="https://github.com/benswift/benswift.github.io/commits/main/blog/2019/10/15/sound-file-io-in-extempore-with-libsndfile" data-astro-cid-gcn2mc3v>history</a> </p> </footer>  <script type="module">const e=["https://tilleys.com.au","https://www.harvestcoffee.com.au","https://www.facebook.com/goodbrothercbr","https://frontgallerycafe.com","https://redbrick.coffee"];function t(){document.querySelectorAll(".random-cafe").forEach(o=>{o.addEventListener("click",a=>{a.preventDefault(),window.location.href=e[Math.floor(Math.random()*e.length)]})})}t();document.addEventListener("astro:page-load",t);</script>  </main> </body></html>